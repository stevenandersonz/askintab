<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Highlighter</title>
    <style>
        body {
            max-width: 800px;
            margin: 20px auto;
            font-family: Arial, sans-serif;
            line-height: 1.6;
        }
        .highlight {
            background-color: yellow;
        }
        #content {
            padding: 20px;
            border: 1px solid #ccc;
        }
        #clearBtn {
            margin-top: 10px;
            padding: 5px 10px;
        }
    </style>
</head>
<body>
    <div id="content">
        <h1>Sample Text</h1>
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat.</p>
        <p>Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.</p>
    </div>
    <button id="clearBtn">Clear All Highlights</button>

    <script>
        // Load saved highlights when page loads
        document.addEventListener('DOMContentLoaded', loadHighlights);

        // Handle text selection
        document.getElementById('content').addEventListener('mouseup', function() {
            const selection = window.getSelection();
            if (selection.toString().length > 0) {
                highlightSelection(selection);
            }
        });

        // Clear highlights button
        document.getElementById('clearBtn').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all highlights?')) {
                localStorage.removeItem('highlights');
                location.reload();
            }
        });

        function highlightSelection(selection) {
            const range = selection.getRangeAt(0);
            const span = document.createElement('span');
            span.className = 'highlight';
            span.textContent = selection.toString();
            
            // Replace the selected text with highlighted version
            range.deleteContents();
            range.insertNode(span);
            
            // Save highlights
            saveHighlights();
            
            // Clear selection
            selection.removeAllRanges();
        }

        function saveHighlights() {
            const highlightedElements = document.getElementsByClassName('highlight');
            const highlights = [];
            
            for (let element of highlightedElements) {
                highlights.push({
                    text: element.textContent,
                    parentPath: getElementPath(element)
                });
            }
            
            localStorage.setItem('highlights', JSON.stringify(highlights));
        }

        function loadHighlights() {
            const savedHighlights = JSON.parse(localStorage.getItem('highlights') || '[]');
            
            savedHighlights.forEach(highlight => {
                const parent = getElementByPath(highlight.parentPath);
                if (parent) {
                    const textNodes = getTextNodes(parent);
                    for (let node of textNodes) {
                        if (node.textContent.includes(highlight.text)) {
                            const range = document.createRange();
                            const startIndex = node.textContent.indexOf(highlight.text);
                            range.setStart(node, startIndex);
                            range.setEnd(node, startIndex + highlight.text.length);
                            
                            const span = document.createElement('span');
                            span.className = 'highlight';
                            range.surroundContents(span);
                            break;
                        }
                    }
                }
            });
        }

        function getElementPath(element) {
            const path = [];
            let current = element.parentElement;
            
            while (current && current !== document.getElementById('content')) {
                const index = Array.prototype.indexOf.call(current.parentElement.children, current);
                path.unshift(index);
                current = current.parentElement;
            }
            return path;
        }

        function getElementByPath(path) {
            let current = document.getElementById('content');
            
            for (let index of path) {
                if (current.children[index]) {
                    current = current.children[index];
                } else {
                    return null;
                }
            }
            return current;
        }

        function getTextNodes(element) {
            const nodes = [];
            const walker = document.createTreeWalker(
                element,
                NodeFilter.SHOW_TEXT,
                null,
                false
            );
            
            let node;
            while (node = walker.nextNode()) {
                nodes.push(node);
            }
            return nodes;
        }
    </script>
</body>
</html>