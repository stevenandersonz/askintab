<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Apple-Style Popover on Text Selection</title>
    <style>
        body {
            background-color: #1a1a1a;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            color: #ffffff;
        }

        .content {
            max-width: 600px;
            padding: 20px;
            font-size: 16px;
            line-height: 1.5;
            user-select: text;
        }

        .popover {
            position: absolute;
            background-color: #2c2c2e;
            border-radius: 12px;
            padding: 16px;
            width: 280px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.4);
            opacity: 0;
            visibility: hidden;
            transform: scale(0.9);
            transition: transform 0.2s ease-out, opacity 0.2s ease-out;
            z-index: 1000;
        }

        .popover.open {
            opacity: 1;
            visibility: visible;
            transform: scale(1);
        }

        .popover::before {
            content: '';
            position: absolute;
            width: 0;
            height: 0;
            border: 8px solid transparent;
            border-bottom-color: #2c2c2e;
            top: -16px;
            left: 10px; /* Adjusted to align with left side */
        }

        .close-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            background: none;
            border: none;
            color: #8e8e93;
            font-size: 18px;
            cursor: pointer;
            padding: 4px;
        }

        .close-btn:hover {
            color: #ffffff;
        }

        .popover-form {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .input-row {
            display: flex;
            justify-content: center;
        }

        .input-row input {
            width: 100%;
            padding: 8px 12px;
            background-color: #3a3a3c;
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
        }

        .input-row input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #007aff;
        }

        .action-row {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
        }

        .action-row select {
            padding: 8px 12px;
            background-color: #3a3a3c;
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
        }

        .action-row button {
            padding: 8px 16px;
            background-color: #007aff;
            border: none;
            border-radius: 8px;
            color: #ffffff;
            font-size: 14px;
            cursor: pointer;
        }

        .action-row button:hover {
            background-color: #005bb5;
        }
    </style>
</head>
<body>
    <div class="content">
        Lorem ipsum dolor sit amet, consectetur adipiscing elit. Sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.
    </div>

    <div class="popover">
        <button class="close-btn">âœ•</button>
        <form class="popover-form">
            <div class="input-row">
                <input type="text" placeholder="Enter text">
            </div>
            <div class="action-row">
                <select>
                    <option value="option1">Option 1</option>
                    <option value="option2">Option 2</option>
                    <option value="option3">Option 3</option>
                </select>
                <button type="submit">Submit</button>
            </div>
        </form>
    </div>

    <script>
        const popover = document.querySelector('.popover');
        const closeBtn = document.querySelector('.close-btn');
        const input = document.querySelector('.popover-form input');
        const content = document.querySelector('.content');

        function positionPopover(range) {
            const rect = range.getBoundingClientRect();
            const popoverWidth = popover.offsetWidth;
            const popoverHeight = popover.offsetHeight;

            // Position popover so top-left is below bottom-right of selection
            let top = rect.bottom + window.scrollY + 10; // 10px below selection
            let left = rect.right + window.scrollX; // Align with right edge of selection

           
            popover.querySelector('::before').style.top = '-16px';
            popover.querySelector('::before').style.bottom = 'auto';

            popover.style.top = `${top}px`;
            popover.style.left = `${left}px`;
        }

        content.addEventListener('mouseup', (e) => {
            setTimeout(() => {
                const selection = window.getSelection();
                if (selection.toString().length > 0) {
                    const range = selection.getRangeAt(0);
                    popover.classList.add('open');
                    positionPopover(range);
                    input.focus();
                }
            }, 10);
        });

        closeBtn.addEventListener('click', () => {
            popover.classList.remove('open');
            window.getSelection().removeAllRanges();
        });

        document.addEventListener('click', (e) => {
            if (!popover.contains(e.target) && e.target !== content) {
                popover.classList.remove('open');
                window.getSelection().removeAllRanges();
            }
        });

        document.addEventListener('selectionchange', () => {
            if (!window.getSelection().toString().length) {
                popover.classList.remove('open');
            }
        });
    </script>
</body>
</html>